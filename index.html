<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PHHS Daily Factoring Review (AI Generator)</title>
  <meta name="description" content="Generates 4 factoring problems of different types each day with solutions — reproducible by date. Optional teacher date preview." />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  <style>
    :root{
      --bg:#0b1020; --card:#111833; --ink:#e9edf7; --muted:#b7c0d9; --accent:#6aa6ff; --ok:#38c172; --warn:#f9ac3d;
      --border: #22305e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
      background: radial-gradient(1200px 900px at 10% 0%, #15224d 0%, var(--bg) 60%);
      color:var(--ink);
    }
    header{padding:24px 20px 10px; display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
    h1{margin:0; font-size: clamp(1.2rem, 2.2vw + .6rem, 2rem); letter-spacing:.3px}
    .tag{font-size:.85rem; color:var(--muted)}
    main{max-width:1100px; margin:0 auto; padding: 0 16px 48px}
    .panel{background:linear-gradient(180deg,#121a37,#0e1530); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35)}
    .controls{display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:12px; align-items:end}
    .controls .col{display:flex; flex-direction:column; gap:6px}
    label{font-size:.8rem; color:var(--muted)}
    input[type="date"], input[type="text"], select{height:40px; border:1px solid var(--border); border-radius:10px; background:#0b1330; color:var(--ink); padding:0 12px}
    button{height:40px; padding:0 14px; border-radius:10px; border:1px solid var(--border); background:#13204d; color:var(--ink); font-weight:600; cursor:pointer}
    button:hover{background:#192a63}
    .btn-primary{background:linear-gradient(180deg,#2b56cc,#2348ac); border-color:#2b56cc}
    .btn-primary:hover{filter:brightness(1.05)}
    .btn-ghost{background:transparent}
    .grid{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:16px; margin-top:16px}
    .card{background:linear-gradient(180deg,#121a37,#0e1530); border:1px solid var(--border); border-radius:14px; padding:16px}
    .card h3{margin:2px 0 12px; font-size:1rem; color:#cdd7ff; letter-spacing:.3px}
    .problem{font-size:1.15rem;}
    .meta{font-size:.86rem; color:var(--muted)}
    details{margin-top:8px}
    summary{cursor:pointer; color:var(--accent); font-weight:600}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .help{color:var(--muted); font-size:.88rem}
    .pill{padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:#0b1330; color:#cdd7ff; font-size:.75rem}
    .footer{margin-top:16px; display:flex; gap:10px; align-items:center; justify-content:space-between}
    .footnote{color:var(--muted); font-size:.8rem}
    @media (max-width: 860px){
      .controls{grid-template-columns: repeat(2,minmax(0,1fr))}
      .grid{grid-template-columns: 1fr}
    }
    .kbd{font: 600 .78rem ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color:#d5e2ff; background:#0f1a3f; border:1px solid var(--border); border-bottom-color:#192a63; padding:2px 6px; border-radius:7px}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>PHHS Daily Factoring Review</h1>
      <div class="tag">4 problems • 4 types • reproducible by date • step-by-step solutions</div>
    </div>
  </header>

  <main>
    <section class="panel">
      <div class="controls">
        <div class="col">
          <label for="date">Date</label>
          <input id="date" type="date" />
        </div>
        <div class="col">
          <label for="seed">Teacher Seed (optional)</label>
          <input id="seed" type="text" placeholder="e.g., blockB or 3rdHour" />
        </div>
        <div class="col">
          <label>&nbsp;</label>
          <button id="regen" class="btn-primary">Generate Set</button>
        </div>
        <div class="col">
          <label>&nbsp;</label></div>
        <div class="col">
          <label>&nbsp;</label>
          <button id="copyLaTeX" class="btn-ghost">Copy Problems (LaTeX)</button>
        </div>
        <div class="col">
          <label>&nbsp;</label>
          <button id="printBtn" class="btn-ghost">Print / Save PDF</button>
        </div>
      </div>
      <div class="help" style="margin-top:10px">Tip: The same date + teacher seed yields the same set. Share the URL to lock in a day’s work (uses <span class="kbd">?d=YYYY-MM-DD&k=seed</span>).</div>
      <div class="grid" id="problems"></div>
      <div class="footer">
        <div class="row">
          <span class="pill">Types: GCF • Difference of Squares • Trinomial (a=1) • Trinomial (a>1)</span>
        </div>
        <div class="footnote">Built-in generator (deterministic); AI hints optional via local rules. No student data stored.</div>
      </div>
    </section>
  </main>

  <script>
    // ---------- Seeded RNG (xmur3 + mulberry32) ----------
    function xmur3(str) {
      let h = 1779033703 ^ str.length;
      for (let i = 0; i < str.length; i++) {
        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
        h = (h << 13) | (h >>> 19);
      }
      return function() {
        h = Math.imul(h ^ (h >>> 16), 2246822507);
        h = Math.imul(h ^ (h >>> 13), 3266489909);
        return (h ^= h >>> 16) >>> 0;
      };
    }
    function mulberry32(a) {
      return function() {
        let t = (a += 0x6d2b79f5);
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }
    function seededRand(seedStr){
      const seed = xmur3(seedStr)();
      return mulberry32(seed);
    }

    // ---------- Utilities ----------
    function sample(rand, arr){ return arr[Math.floor(rand()*arr.length)]; }
    function randint(rand, min, max){ return Math.floor(rand()*(max-min+1))+min; }
    function coin(rand){ return rand()<0.5; }

    function texPoly(coeffs){
      // coeffs for ax^2 + bx + c -> [a,b,c]
      const [a,b,c]=coeffs;
      let parts=[];
      function term(coef, pow){
        if(coef===0) return null;
        let sign = coef<0 ? '-' : '+';
        let abs = Math.abs(coef);
        if(pow===0){
          return (parts.length? ' ' + sign + ' ' : (coef<0?'-':'')) + abs;
        }else if(pow===1){
          const cstr = abs===1? '' : abs;
          return (parts.length? ' ' + sign + ' ' : (coef<0?'-':'')) + cstr + 'x';
        }else{
          const cstr = abs===1? '' : abs;
          return (parts.length? ' ' + sign + ' ' : (coef<0?'-':'')) + cstr + 'x^{'+pow+'}';
        }
      }
      const t2 = term(a,2); if(t2) parts.push(t2);
      const t1 = term(b,1); if(t1) parts.push(t1);
      const t0 = term(c,0); if(t0) parts.push(t0);
      return parts.join('');
    }

    function simplifySigns(str){
      return str.replace(/\+\s*-\s*/g,'- ').replace(/-\s*-\s*/g,'+ ');
    }

    // ---------- Problem Generators ----------
    function genGCF(rand){
      // Form: ax^2 + bx + c OR 3-term with common numeric factor (and maybe x)
      const g = randint(rand,2,9); // numeric GCF
      const includeX = coin(rand); // common x factor?
      const a = g * randint(rand,1,6);
      const b = g * randint(rand,1,6) * (coin(rand)?1:-1);
      const c = g * randint(rand,1,6) * (coin(rand)?1:-1);
      const pow = includeX ? randint(rand,1,2) : 0; // x or x^2 common
      // Build terms respecting x power
      // We'll make: g*x^pow * (A x^{2-pow} + B x^{1-pow} + C x^{-pow}) but ensure nonnegative exponents
      let A=randint(rand,1,6), B=randint(rand,1,8), C=randint(rand,1,9);
      if(coin(rand)) B*=-1; if(coin(rand)) C*=-1;
      const inside = [A, (pow<=1?B:0), (pow===0?C:(pow===1?C:0))];
      // If pow=2, we only keep ax^2 + c to avoid negative exponents
      const poly = [g*A, (pow<=1? g*B : 0), (pow===0? g*C : 0)];
      const factor = g + (pow>0? 'x' + (pow===1?'':'^{'+pow+'}') : '');
      const insideTex = texPoly(inside);
      const q = `Factor: \(${texPoly(poly)}\)`;
      const aTex = `\(${factor}\left(${insideTex}\right)\)`;
      const steps = [
        `Find the GCF: numeric \(${g}\)` + (pow>0? ` and variable \(x^{${pow}}\)` : ''),
        `Factor out the GCF: \(${factor}\)`,
        `Remaining trinomial: \(${insideTex}\)`
      ];
      return { type:'GCF', question:q, answer:aTex, steps };
    }

    function genDiffSquares(rand){
      // a^2 x^2 - b^2
      const a = randint(rand,2,12);
      const b = randint(rand,2,12);
      const q = `Factor: \(${a*a}x^{2} - ${b*b}\)`;
      const aTex = `\((${a}x - ${b})(${a}x + ${b})\)`;
      const steps = [
        `Recognize difference of squares: \(A^2 - B^2 = (A-B)(A+B)\)`,
        `Here, \(A=${a}x\) and \(B=${b}\)`
      ];
      return { type:'Difference of Squares', question:q, answer:aTex, steps };
    }

    function genTrinomialA1(rand){
      // x^2 + bx + c, factorable
      const m = randint(rand,1,12) * (coin(rand)?1:-1);
      const n = randint(rand,1,12) * (coin(rand)?1:-1);
      const b = m + n; const c = m * n;
      const q = `Factor: \(x^{2} ${b>=0?'+':''}${b}x ${c>=0?'+':''}${c}\)`;
      const aTex = `\((x ${m>=0?'+':''}${m})(x ${n>=0?'+':''}${n})\)`;
      const steps = [
        `Find two integers that multiply to \(c=${c}\) and add to \(b=${b}\): \(${m}\) and \(${n}\)`
      ];
      return { type:'Trinomial (a=1)', question:q, answer:aTex, steps };
    }

    function genTrinomialAGt1(rand){
      // (px + r)(qx + s)
      const p = randint(rand,2,6);
      const q = randint(rand,2,6);
      const r = randint(rand,1,10) * (coin(rand)?1:-1);
      const s = randint(rand,1,10) * (coin(rand)?1:-1);
      const a = p*q; const b = p*s + q*r; const c = r*s;
      const qtex = `Factor: \\(${texPoly([a,b,c])}\\)`;
      const atex = `\\((${p}x ${r>=0?'+':''}${r})(${q}x ${s>=0?'+':''}${s})\\)`;
      const steps = [
        `Use grouping or the AC method (here built from factors):`,
        `We constructed it from \((${p}x ${r>=0?'+':''}${r})(${q}x ${s>=0?'+':''}${s})\)`
      ];
      return { type:'Trinomial (a>1)', question:qtex, answer:atex, steps };
    }

    // ---------- Render & State ----------
    const problemsEl = document.getElementById('problems');
    const dateEl = document.getElementById('date');
    const seedEl = document.getElementById('seed');
    const btnRegen = document.getElementById('regen');const btnCopy = document.getElementById('copyLaTeX');
    const btnPrint = document.getElementById('printBtn');

    function chicagoISO(d=new Date()){
      // Convert to America/Chicago local date string YYYY-MM-DD
      const fmt = new Intl.DateTimeFormat('en-CA', { timeZone:'America/Chicago', year:'numeric', month:'2-digit', day:'2-digit' });
      const parts = fmt.formatToParts(d); // e.g., 2025-09-10
      const y = parts.find(p=>p.type==='year').value;
      const m = parts.find(p=>p.type==='month').value;
      const da = parts.find(p=>p.type==='day').value;
      return `${y}-${m}-${da}`;
    }

    function readParams(){
      const sp = new URLSearchParams(location.search);
      const d = sp.get('d');
      const k = sp.get('k');
      if(d) dateEl.value = d; else dateEl.value = chicagoISO();
      if(k) seedEl.value = k;
    }

    function currentSeed(){
      const d = dateEl.value || chicagoISO();
      const k = seedEl.value.trim();
      return `${d}::${k}`;
    }

    function generate(){
      const rand = seededRand(currentSeed());
      const gens = [genGCF, genDiffSquares, genTrinomialA1, genTrinomialAGt1];
      const set = gens.map(fn => fn(rand));
      renderSet(set);
      const url = new URL(location.href);
      url.searchParams.set('d', dateEl.value || chicagoISO());
      if(seedEl.value.trim()) url.searchParams.set('k', seedEl.value.trim()); else url.searchParams.delete('k');
      history.replaceState({}, '', url);
    }

    function cardHTML(idx, p){
      return `
        <article class="card" data-idx="${idx}">
          <h3>${idx+1}. ${p.type}</h3>
          <div class="problem">$${p.question}$</div>
          <details>
            <summary>Show solution</summary>
            <div class="meta" style="margin-top:6px">Answer: <span>$${p.answer}$</span></div>
            <ol class="meta" style="margin-top:6px">
              ${p.steps.map(s=>`<li>${s.replace(/\$/g,'\\$')}</li>`).join('')}
            </ol>
          </details>
        </article>`;
    }

    function renderSet(set){
      problemsEl.innerHTML = set.map((p,i)=>cardHTML(i,p)).join('');
      if(window.MathJax) MathJax.typesetPromise?.();
      window.__currentSet = set;
    }

    function copyLaTeX(){
      if(!window.__currentSet) return;
      const lines = window.__currentSet.map((p,i)=>`${i+1}. ${p.question}`);
      const tex = lines.join('\n\n');
      navigator.clipboard.writeText(tex).then(()=>{
        btnCopy.textContent = 'Copied!';
        setTimeout(()=>btnCopy.textContent='Copy Problems (LaTeX)', 1500);
      });
    }

    // Init
    readParams();
    generate();

    btnRegen.addEventListener('click', generate);btnCopy.addEventListener('click', copyLaTeX);
    btnPrint.addEventListener('click', ()=>window.print());
  </script>
</body>
</html>
